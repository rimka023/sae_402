<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Three.js Cube</title>
        <h1 id="point" class="point">Point : 0</h1>
        
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        .point{
            position: absolute;
            font-size: 48px;
            padding-left: 2rem;
            color: white;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.131.2/build/three.min.js"></script>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
        "imports": {
            "three": "../node_modules/three/build/three.module.js",
            "orbitcontrols": "../node_modules/three/examples/jsm/controls/OrbitControls.js"
        }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'orbitcontrols';
        import { HDRCubeTextureLoader } from '../node_modules/three/examples/jsm/loaders/HDRCubeTextureLoader.js';
        import { RGBELoader } from '../node_modules/three/examples/jsm/loaders/RGBELoader.js';
        import { GLTFLoader } from '../node_modules/three/examples/jsm/loaders/GLTFLoader.js';
        
        

        // Create a Three.js scene
        const scene = new THREE.Scene();

        // Create a camera
        const camera = new THREE.PerspectiveCamera(
            75, // Field of view
            window.innerWidth / window.innerHeight, // Aspect ratio
            0.1, // Near clipping plane
            10000 // Far clipping plane
        );
        camera.position.x = 0;
        camera.position.y = 4;
        camera.position.z = 8;
        // camera.position.set(600, 400, 0);

        let compteur = 0;

        // Create a renderer
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Create a cube
		const poubelleN = createPoubelleN(2.5, 0, 0);
		let dechet = createDechet(0, 3, 0);
		const poubelleJ = createPoubelleJ(-1.63, 0, 0);

        scene.add(poubelleN);
		scene.add(dechet);
		scene.add(poubelleJ);
        
        //-----FOND-----------
        const loader = 
        new RGBELoader()
            .setPath('./assets/')
            .load('fondBuilding.hdr', function (texture){
                texture.mapping = THREE.EquirectangularReflectionMapping
            
                scene.background = texture
            })
        //--------OBJET POUBELLE-------------
        //Pas recyclage
        const loaderPoubelleN = new GLTFLoader();

        // Charger l'objet GLB
        loaderPoubelleN.load('./assets/trash_can.glb', function (gltf) {

            // Ajouter l'objet à la scène
            var objectPoubelleN = gltf.scene;
            scene.add(objectPoubelleN);
            objectPoubelleN.position.x = 0;
        })
        //Recyclage 
        const loaderPoubelleJ = new GLTFLoader();

        // Charger l'objet GLB
        loaderPoubelleJ.load('./assets/trashrecyclage.glb', function (gltf) {

            // Ajouter l'objet à la scène
            var objectPoubelleJ = gltf.scene;
            objectPoubelleJ.rotation.y = -1.55;
            objectPoubelleJ.position.x = -1.5;
            objectPoubelleJ.position.y = -.6;
            objectPoubelleJ.position.z = .2;


            scene.add(objectPoubelleJ);
        })


        var ambientLight = new THREE.AmbientLight(0xffffff, 7);
        scene.add(ambientLight);
            

        const control = new OrbitControls(camera, renderer.domElement)

        
		const raycaster = new THREE.Raycaster();
		const mouse = new THREE.Vector2();

		
		

        function createDechet(x, y, z) {
            const geometry = new THREE.BoxGeometry(.3, .3, .3);
			const material = new THREE.MeshBasicMaterial({ color: Math.random() < 0.5 ? 0xcccc00 : 0x000000 });
			const cube = new THREE.Mesh(geometry, material);
            console.log(material);
            cube.color = material.color
			cube.position.set(x, y, z);
			return cube;
		}
        function createDechet2(x, y, z) {
            const geometry = new THREE.BoxGeometry(.3, .3, .3);
			const material = new THREE.MeshBasicMaterial({ color: Math.random() < 0.5 ? 0xcccc00 : 0x000000 });
			const cube = new THREE.Mesh(geometry, material);
			cube.position.set(x, y, z);
			return cube;
		}

        function createPoubelleJ(x, y, z) {
			const geometry = new THREE.BoxGeometry(1.75, 1, 1);
			const material = new THREE.MeshBasicMaterial({ color: 0xcccc00 });
			const cube = new THREE.Mesh(geometry, material);
			cube.position.set(x, y, z);
			return cube;
		}

        function createPoubelleN(x, y, z) {
			const geometry = new THREE.BoxGeometry(1, 1.5, 1);
			const material = new THREE.MeshBasicMaterial({ color: 0x000000 });
			const cube = new THREE.Mesh(geometry, material);
			cube.position.set(x, y, z);
			return cube;
		}

		// add an event listener for clicks
		window.addEventListener('click', onMouseClick);
        
		// function to handle clicks
		function onMouseClick(event) {
			event.preventDefault();
			mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
			mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
			raycaster.setFromCamera(mouse, camera);
			const intersects = raycaster.intersectObjects(scene.children, true);
			if (intersects.length > 0) {
                const selectedObject = intersects[0].object;
				if (selectedObject === poubelleN && dechet.material.color.r == 0) {
					scene.remove(dechet);
                    const dechet2 = createDechet2(0, 3, 0);
                    scene.add(dechet2);
                    alert('Bien joué');
                    dechet = dechet2;
                    compteur += 1;
                    document.getElementById('point').innerHTML = 'Points : ' + compteur ;
                    console.log(compteur);
                }

                else if (selectedObject === poubelleJ && dechet.material.color.r > 0) {
					scene.remove(dechet);
					// selectedObject.add(dechet);
					// dechet.position.set(0, 0, 0);
                    const dechet2 = createDechet2(0, 3, 0);
                    scene.add(dechet2);
                    alert('Bien joué');
                    dechet = dechet2;
                    compteur += 1;
                    document.getElementById('point').innerHTML = 'Points : ' + compteur ;

                    console.log(compteur);
			    }

                else{
                    scene.remove(dechet);
                    const dechet2 = createDechet2(0, 3, 0);
                    scene.add(dechet2);
                    dechet = dechet2;
                }
            }
		}
        
        renderer.setClearColor(0xffffff, 1, 0);

        // Render the scene
        const animate = () => {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
            dechet.rotation.y += 0.03
        };
        animate();




    </script>
</body>

</html>