<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Three.js Cube</title>
        <h1 id="point" class="point">Point : 0</h1>
        
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        .point{
            position: absolute;
            font-size: 48px;
            padding-left: 2rem;
            color: white;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.131.2/build/three.min.js"></script>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
        "imports": {
            "three": "../node_modules/three/build/three.module.js",
            "orbitcontrols": "../node_modules/three/examples/jsm/controls/OrbitControls.js"
        }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'orbitcontrols';
        import { HDRCubeTextureLoader } from '../node_modules/three/examples/jsm/loaders/HDRCubeTextureLoader.js';
        import { RGBELoader } from '../node_modules/three/examples/jsm/loaders/RGBELoader.js';
        import { GLTFLoader } from '../node_modules/three/examples/jsm/loaders/GLTFLoader.js';
        
        

        // Create a Three.js scene
        const scene = new THREE.Scene();

        // Create a camera
        const camera = new THREE.PerspectiveCamera(
            75, // Field of view
            window.innerWidth / window.innerHeight, // Aspect ratio
            0.1, // Near clipping plane
            10000 // Far clipping plane
        );
        camera.position.x = 0;
        camera.position.y = 2;
        camera.position.z = 4;
        // camera.position.set(600, 400, 0);

        let compteur = 0;

        // Create a renderer
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Create a cube
		const poubelleN = createPoubelleN(1.4, .11, .24);
		let dechet = createDechet(0, 2, 0);
		const poubelleJ = createPoubelleJ(-1.7, 0, -.12);

        scene.add(poubelleN);
		scene.add(dechet);
		scene.add(poubelleJ);
        
        //-----FOND-----------
        const loader = 
        new RGBELoader()
            .setPath('./assets/')
            .load('fondBuilding.hdr', function (texture){
                texture.mapping = THREE.EquirectangularReflectionMapping
            
                scene.background = texture
            })
        //--------OBJET POUBELLE-------------
        //Pas recyclage
        const loaderPoubelleN = new GLTFLoader();

        // Charger l'objet GLB
        loaderPoubelleN.load('./assets/trash_can.glb', function (gltf) {

            // Ajouter l'objet à la scène
            var objectPoubelleN = gltf.scene;
            objectPoubelleN.position.x = .2;
            objectPoubelleN.position.z = -.4;
            objectPoubelleN.rotation.y = -.5;

            scene.add(objectPoubelleN);

        })
        //Recyclage 
        const loaderPoubelleJ = new GLTFLoader();

        // Charger l'objet GLB
        loaderPoubelleJ.load('./assets/trashrecyclage.glb', function (gltf) {

            // Ajouter l'objet à la scène
            var objectPoubelleJ = gltf.scene;
            objectPoubelleJ.rotation.y = -1.20;
            objectPoubelleJ.position.x = -1.5;
            objectPoubelleJ.position.y = -.6;
            objectPoubelleJ.position.z = .2;


            scene.add(objectPoubelleJ);
        })

        //-------Object----------------

        var loaderObjects = new GLTFLoader();
        var objects = [];

        loaderObjects.load(
        // URL du document GLB
        './assets/burger.glb',

        // Fonction de rappel appelée lorsque le chargement est terminé
        function(gltf) {
            var object = gltf.scene;
            object.name = 'Burger';
            object.recyclable = 'No';
            object.position.y = 2.5;
            object.scale.y = .25;
            object.scale.x = .25;      
            object.scale.z = .25; 
            scene.add(object);
            objects.push(object);
        }
        );

        loaderObjects.load(
            // URL du document GLB
            './assets/plastic_bottle.glb',

            // Fonction de rappel appelée lorsque le chargement est terminé
            function(gltf) {
                var object = gltf.scene;
                object.name = 'Plastic bottle';
                object.recyclable = 'Yes';
                object.position.y = 2.5;  
                object.scale.y = .05;
                object.scale.x = .07;      
                object.scale.z = .07;  
                scene.add(object);
                objects.push(object);
            }
        );

        loaderObjects.load(
            // URL du document GLB
            './assets/teeth_brush.glb',

            // Fonction de rappel appelée lorsque le chargement est terminé
            function(gltf) {
                var object = gltf.scene;
                object.name = 'Teeth brush';
                object.recyclable = 'No';
                object.position.y = 2.5;
                object.position.z = -.15;
                object.position.x = -.12;
                object.scale.y = .015;
                object.scale.x = .025;      
                object.scale.z = .025;
                scene.add(object);
                objects.push(object);
            }
        );
        loaderObjects.load(
            // URL du document GLB
            './assets/slice_of_pizza.glb',

            // Fonction de rappel appelée lorsque le chargement est terminé
            function(gltf) {
                var object = gltf.scene;
                object.name = 'Pizza';
                object.recyclable = 'No';
                object.position.y = 2.5;
                // object.position.z = -.15;
                // object.position.x = -.12;
                object.scale.y = 5;
                object.scale.x = 5;      
                object.scale.z = 5;
                scene.add(object);
                objects.push(object);
            }
        );
        loaderObjects.load(
            // URL du document GLB
            './assets/food_can_415g.glb',

            // Fonction de rappel appelée lorsque le chargement est terminé
            function(gltf) {
                var object = gltf.scene;
                object.name = 'Food can';
                object.recyclable = 'Yes';
                object.position.y = 2.5;
                // object.position.z = -.15;
                // object.position.x = -.12;
                object.scale.y = 1.5;
                object.scale.x = 1.5;      
                object.scale.z = 1.5;
                scene.add(object);
                objects.push(object);
            }
        );
        loaderObjects.load(
            // URL du document GLB
            './assets/aerosol_en_partes.glb',

            // Fonction de rappel appelée lorsque le chargement est terminé
            function(gltf) {
                var object = gltf.scene;
                object.name = 'Aerosol';
                object.recyclable = 'Yes';
                object.position.y = 2.5;
                scene.add(object);
                objects.push(object);
            }
        );
        loaderObjects.load(
            // URL du document GLB
            './assets/aluminum_tray.glb',

            // Fonction de rappel appelée lorsque le chargement est terminé
            function(gltf) {
                var object = gltf.scene;
                object.name = 'Aeluminum tray';
                object.recyclable = 'Yes';
                object.position.y = 2.5;
                object.scale.y = .2;
                object.scale.x = .2;      
                object.scale.z = .2;
                scene.add(object);
                objects.push(object);
            }
        );

        var ambientLight = new THREE.AmbientLight(0xffffff, 7);
        scene.add(ambientLight);
            

        const control = new OrbitControls(camera, renderer.domElement)

        
		const raycaster = new THREE.Raycaster();
		const mouse = new THREE.Vector2();

		
		

        function createDechet(x, y, z) {
            const geometry = new THREE.BoxGeometry(.3, .3, .3);
			const material = new THREE.MeshBasicMaterial({ color: Math.random() < 0.5 ? 0xcccc00 : 0x000000 });
			const cube = new THREE.Mesh(geometry, material);
            console.log(material);
            cube.color = material.color
			cube.position.set(x, y, z);
			return cube;
		}
        function createDechet2(x, y, z) {
            const geometry = new THREE.BoxGeometry(.3, .3, .3);
			const material = new THREE.MeshBasicMaterial({ color: Math.random() < 0.5 ? 0xcccc00 : 0x000000 });
			const cube = new THREE.Mesh(geometry, material);
			cube.position.set(x, y, z);
			return cube;
		}

        function createPoubelleJ(x, y, z) {
			const geometry = new THREE.BoxGeometry(2.2, 1.85, 1.3);
			const material = new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent:true, opacity:0 });
			const cube = new THREE.Mesh(geometry, material);
			cube.position.set(x, y, z);
            cube.rotation.y = 0.37;

			return cube;
		}

        function createPoubelleN(x, y, z) {
			const geometry = new THREE.BoxGeometry(1.18, 1.70, 1.63);
			const material = new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent:true, opacity:0 });
			const cube = new THREE.Mesh(geometry, material);
			cube.position.set(x, y, z);
            cube.rotation.y = 1.071;

			return cube;
		}

		// add an event listener for clicks
		window.addEventListener('click', onMouseClick);
        
		// function to handle clicks
		function onMouseClick(event) {
			event.preventDefault();
			mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
			mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
			raycaster.setFromCamera(mouse, camera);
			const intersects = raycaster.intersectObjects(scene.children, true);
			if (intersects.length > 0) {
                const selectedObject = intersects[0].object;
				if (selectedObject === poubelleN && dechet.material.color.r == 0) {
					scene.remove(dechet);
                    const dechet2 = createDechet2(0, 2, 0);
                    scene.add(dechet2);
                    alert('Bien joué');
                    dechet = dechet2;
                    compteur += 1;
                    document.getElementById('point').innerHTML = 'Points : ' + compteur ;
                    
                }

                else if (selectedObject === poubelleJ && dechet.material.color.r > 0) {
					scene.remove(dechet);
					// selectedObject.add(dechet);
					// dechet.position.set(0, 0, 0);
                    const dechet2 = createDechet2(0, 2, 0);
                    scene.add(dechet2);
                    alert('Bien joué');
                    dechet = dechet2;
                    compteur += 1;
                    document.getElementById('point').innerHTML = 'Points : ' + compteur ;

			    }

                else{
                    scene.remove(dechet);
                    const dechet2 = createDechet2(0, 2, 0);
                    scene.add(dechet2);
                    dechet = dechet2;
                }
            }
		}
        
        renderer.setClearColor(0xffffff, 1, 0);

        // Render the scene
        const animate = () => {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
            dechet.rotation.y += 0.03
        };
        animate();




    </script>
</body>

</html>